# Sheffield å¤§å­¦ç­¾åˆ°åŠ©æ‰‹ - è¿ç§»è¯´æ˜

## ğŸ“ è¿ç§»æ¦‚è¿°

æœ¬é¡¹ç›®ä» Bristol å¤§å­¦ç‰ˆæœ¬æˆåŠŸè¿ç§»è‡³ Sheffield å¤§å­¦ã€‚ä¸¤æ ¡ä½¿ç”¨ç›¸åŒçš„ CampusM å¹³å°ï¼Œå› æ­¤æ ¸å¿ƒé€»è¾‘ä¿æŒä¸å˜ã€‚

## ğŸ”„ ä¸»è¦å˜æ›´

### 1. åŸŸåæ›´æ–°
- **Bristol**: `app.bristol.ac.uk`
- **Sheffield**: `i.sheffield.ac.uk`

### 2. API ç«¯ç‚¹å˜æ›´

| åŠŸèƒ½ | Bristol | Sheffield |
|------|---------|-----------|
| SSOè®¤è¯ | `/campusm/sso/state` | `/campusm/sso/ldap/204` |
| ç”¨æˆ·è®¾ç½® | - | `/campusm/setupuser/204/224` |
| è¯¾ç¨‹è¡¨ | `/campusm/sso/cal2/Student Timetable` | `/campusm/sso/cal2/Course Timetable (2025-26)` |
| ç­¾åˆ° | `/campusm/attendance/checkin` | `/campusm/attendance/checkin` âœ… |
| ç­¾åˆ°å†å² | - | `/campusm/attendance/checkin-history` |

### 3. ç”¨æˆ·ä¿¡æ¯å­—æ®µ
- **Bristol**: ä½¿ç”¨ `serviceUsername_5076`
- **Sheffield**: ä½¿ç”¨ `serviceUsername_3577`

### 4. é»˜è®¤åæ ‡
- **Bristol**: Merchant Venturers Building (51.455915, -2.602991)
- **Sheffield**: Diamond Building (53.381130, -1.487890)

## ğŸ“‹ å·²ä¿®æ”¹æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
1. âœ… `manifest.json` - æ›´æ–°åŸŸåå’Œæƒé™
2. âœ… `background.js` - æ›´æ–°SSOæ¥å£è·¯å¾„å’Œæ¶ˆæ¯ç±»å‹
3. âœ… `content.js` - æ›´æ–°æ¶ˆæ¯æºæ ‡è¯†
4. âœ… `inject.js` - æ›´æ–°æ‹¦æˆªè·¯å¾„å’Œæ—¥å¿—
5. âœ… `popup.js` - æ›´æ–°APIç«¯ç‚¹å’Œé»˜è®¤åæ ‡
6. âœ… `popup.html` - æ›´æ–°UIæ–‡æ¡ˆ
7. âœ… `README.md` - æ›´æ–°æ–‡æ¡£

### å…³é”®ä»£ç å˜æ›´

#### manifest.json
```json
{
  "name": "Sheffield æå‰ç­¾åˆ°åŠ©æ‰‹",
  "host_permissions": [
    "https://i.sheffield.ac.uk/*",
    "https://*.sheffield.ac.uk/*"
  ]
}
```

#### SSOæ‹¦æˆªè·¯å¾„
```javascript
const TARGET_PATHS = [
  '/campusm/sso/ldap', 
  '/campusm/setupuser', 
  '/sso/ldap', 
  '/sso/state'
];
```

#### è¯¾ç¨‹è¡¨API
```javascript
const url = `https://i.sheffield.ac.uk/campusm/sso/cal2/Course%20Timetable%20(2025-26)?start=${start}&end=${end}`;
```

#### ç­¾åˆ°API
```javascript
fetch('https://i.sheffield.ac.uk/campusm/attendance/checkin', {
  method: 'POST',
  body: JSON.stringify({
    eventRef, eventStart, eventEnd, eventDesc,
    deviceLat, deviceLong, devicePrecision: 10,
    checkInType: "SELF",
    locationRef: "", otc: null, qr: null
  })
});
```

## ğŸ§ª æµ‹è¯•è¦ç‚¹

### å¿…é¡»æµ‹è¯•çš„åŠŸèƒ½
1. âœ… SSO è®¤è¯ä¿¡æ¯è·å–
2. âœ… Cookie è‡ªåŠ¨æå–
3. âœ… è¯¾ç¨‹è¡¨æŸ¥è¯¢
4. âš ï¸ ç­¾åˆ°åŠŸèƒ½ï¼ˆéœ€è¦å®é™…è¯¾ç¨‹ï¼‰
5. âœ… åœ°ç†ç¼–ç ï¼ˆOpenStreetMap APIï¼‰

### æ½œåœ¨é—®é¢˜
1. **è¯¾ç¨‹è¡¨API**: å¹´ä»½å‚æ•° `2025-26` å¯èƒ½éœ€è¦æ ¹æ®å®é™…å­¦å¹´è°ƒæ•´
2. **ç­¾åˆ°éªŒè¯**: Sheffieldå¯èƒ½æœ‰ä¸åŒçš„éªŒè¯è§„åˆ™ï¼ˆOTCå¯†ç ã€äºŒç»´ç ç­‰ï¼‰
3. **åœ°ç†ä½ç½®**: æŸäº›ç‰¹æ®Šæ•™å®¤å¯èƒ½éœ€è¦ç²¾ç¡®åæ ‡

## ğŸš€ å®‰è£…å’Œä½¿ç”¨

### å®‰è£…æ­¥éª¤
1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. å¼€å¯"å¼€å‘è€…æ¨¡å¼"
4. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹©é¡¹ç›®æ–‡ä»¶å¤¹

### ä½¿ç”¨æµç¨‹
1. è®¿é—® `https://i.sheffield.ac.uk/campusm/home` å¹¶ç™»å½•
2. æ‰©å±•ä¼šè‡ªåŠ¨è·å–ç”¨æˆ·ä¿¡æ¯å’ŒCookie
3. æ‰“å¼€æ‰©å±•å¼¹çª—ï¼ŒæŸ¥çœ‹ä¸ªäººä¿¡æ¯
4. é€‰æ‹©æ—¥æœŸèŒƒå›´ï¼Œç‚¹å‡»"è·å–è¯¾ç¨‹è¡¨"
5. å‹¾é€‰éœ€è¦ç­¾åˆ°çš„è¯¾ç¨‹
6. åŒæ„ä½¿ç”¨æ¡æ¬¾åï¼Œç‚¹å‡»"ä¸€é”®ç­¾åˆ°"

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç­¾åˆ°é™åˆ¶
- âš ï¸ **å¯èƒ½æ— æ³•è·³è¿‡å¯†ç **: å¦‚æœè¯¾ç¨‹è¦æ±‚OTCå¯†ç ï¼Œç­¾åˆ°å¯èƒ½å¤±è´¥
- âš ï¸ **éœ€è¦åœ°ç†ä½ç½®**: ç³»ç»Ÿå¯èƒ½æ£€æŸ¥ä¸è¯¾ç¨‹åœ°ç‚¹çš„è·ç¦»
- âš ï¸ **æ—¶é—´é™åˆ¶**: å¯èƒ½åªèƒ½åœ¨ç‰¹å®šæ—¶é—´çª—å£å†…ç­¾åˆ°

### æ•°æ®å®‰å…¨
- âœ… æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°
- âœ… ä¸è¿æ¥ä»»ä½•ç¬¬ä¸‰æ–¹æœåŠ¡å™¨
- âœ… Cookieä»…ç”¨äºAPIè¯·æ±‚

## ğŸ“Š å·²çŸ¥å·®å¼‚

| ç‰¹æ€§ | Bristol | Sheffield | çŠ¶æ€ |
|------|---------|-----------|------|
| CampusMå¹³å° | âœ… | âœ… | å…¼å®¹ |
| ç­¾åˆ°APIç»“æ„ | âœ… | âœ… | ç›¸åŒ |
| è¯¾ç¨‹è¡¨æ ¼å¼ | âœ… | âœ… | ç›¸åŒ |
| å¯†ç éªŒè¯ | å¯è·³è¿‡? | â“ | å¾…æµ‹è¯• |

## ğŸ› è°ƒè¯•å»ºè®®

### æŸ¥çœ‹æ—¥å¿—
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹
// è¿‡æ»¤å…³é”®å­—: "Sheffield Plugin"
```

### æ¸…é™¤æ•°æ®
ç‚¹å‡»æ‰©å±•ä¸­çš„"æ¸…é™¤æ•°æ®"æŒ‰é’®ï¼Œé‡æ–°å¼€å§‹è·å–ä¿¡æ¯

### å¸¸è§é—®é¢˜
1. **æ²¡æœ‰è·å–åˆ°ç”¨æˆ·ä¿¡æ¯**: é‡æ–°ç™»å½• Sheffield ç½‘ç«™
2. **è¯¾ç¨‹è¡¨ä¸ºç©º**: æ£€æŸ¥æ—¥æœŸèŒƒå›´å’Œå­¦å¹´å‚æ•°
3. **ç­¾åˆ°å¤±è´¥**: æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦å¯†ç 

## ğŸ“œ è®¸å¯å’Œå…è´£

- æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨
- ä¸¥ç¦ç”¨äºä»»ä½•å•†ä¸šç”¨é€”
- ä½¿ç”¨é£é™©è‡ªè´Ÿ
- å»ºè®®åˆç†ä½¿ç”¨ï¼Œä¸è¦è¿‡åº¦ä¾èµ–

---

**è¿ç§»å®Œæˆæ—¶é—´**: 2025-10-03  
**åŸé¡¹ç›®ä½œè€…**: æ—æ«â˜ (Bristol ç‰ˆæœ¬)  
**è¿ç§»é€‚é…**: Sheffield å¤§å­¦ç‰ˆæœ¬
