# Sheffield 签到助手 - OTC密码使用指南

## ⚠️ 重要发现

经过测试确认，**Sheffield大学的签到系统强制要求OTC密码**！

## 🔍 测试结果

### 错误信息
```
✗ Software development for mobile devices: 签到失败: OTC is missing in request
✗ Software development for mobile devices: 重复签到失败
```

### 结论
1. ✅ **签到请求成功发送** - 服务器接收了请求
2. ❌ **缺少OTC密码** - 系统拒绝了无OTC的签到
3. ⚠️ **可能记录了无效签到** - 网页显示❌但实际可能被记录

## 📝 什么是OTC？

**OTC (One-Time Code)** = 一次性签到密码

- 📱 由老师在课堂上提供
- 🔢 通常是数字或字母组合
- ⏰ 每次课程可能不同
- 🎯 用于确认学生在现场

## 🛠️ 如何使用更新后的扩展

### 1. 获取课程表
```
1. 打开扩展
2. 选择日期范围
3. 点击"获取课程表"
```

### 2. 输入OTC密码
```
1. 课程表加载后，会显示"OTC签到密码"输入框
2. 输入老师提供的密码
3. 如果老师没有提供密码，可以留空尝试
```

### 3. 执行签到
```
1. 勾选要签到的课程
2. 同意使用条款
3. 点击"一键签到"
```

## 🎯 不同场景的处理

### 场景1: 老师提供了OTC密码
```
✅ 输入密码 → 签到成功
```

### 场景2: 老师未提供OTC密码
```
⚠️ 留空尝试 → 可能失败
建议: 向老师询问密码
```

### 场景3: 不知道是否需要密码
```
💡 先留空尝试
   - 如果提示"OTC is missing" → 需要密码
   - 如果签到成功 → 不需要密码（少见）
```

## 📊 Sheffield vs Bristol 对比

| 特性 | Bristol | Sheffield |
|------|---------|-----------|
| OTC密码 | ❓ 可选/可跳过 | ✅ **强制要求** |
| 位置验证 | ✅ 需要 | ✅ 需要 |
| QR码 | ❓ 可选 | ❓ 可选 |

## 🔧 技术细节

### 签到请求数据结构
```javascript
{
  eventRef: "21259799-2025-10-03 00:00:00.009:00",
  eventStart: "2025-10-03T08:00:00.000+00:00",
  eventEnd: "2025-10-03T10:00:00.000+00:00",
  eventDesc: "Software development for mobile devices",
  deviceTime: "2025-10-03T14:30:00.000Z",
  checkInType: "OTC",
  deviceLat: 53.381130,
  deviceLong: -1.487890,
  devicePrecision: 28,
  locationRef: "Alfred Denny Building",
  otc: "123456",  // ⚠️ 必填！
  qr: null
}
```

### API响应示例

#### 成功
```xml
{
  "checkinStatus": "validated",
  "description": "Check-in successful"
}
```

#### 失败（缺少OTC）
```
"OTC is missing in request"
```

#### 重复签到
```xml
{
  "checkinStatus": "validated",
  "description": "Duplicate check-in"
}
```

## ⚠️ 重要提醒

### 1. 网页显示❌的原因
即使签到请求发送成功，如果缺少OTC或位置不匹配，系统可能：
- ✅ 记录签到尝试
- ❌ 标记为"无效"
- ⚠️ 在教务系统显示为❌

### 2. "重复签到失败"的含义
- 说明第一次尝试**实际上被记录了**
- 但可能因为缺少OTC被标记为无效
- **不要多次重复尝试**！

### 3. 使用建议
1. ✅ **向老师询问OTC密码** - 这是最关键的
2. ✅ **在课堂时间内签到** - 可能有时间窗口限制
3. ✅ **确保位置正确** - 使用真实课程地点坐标
4. ❌ **不要频繁重试** - 可能被标记为作弊

## 🚀 更新内容

### v2.1 - 添加OTC支持
- ✅ 新增OTC密码输入框
- ✅ 自动将输入的密码添加到签到请求
- ✅ 支持留空尝试（虽然可能失败）
- ✅ 更新使用说明

## 📞 常见问题

### Q: 忘记输入OTC密码怎么办？
A: 签到会失败并提示"OTC is missing"，重新输入密码后再试

### Q: 老师没说密码是什么？
A: 询问老师或其他同学，或查看课程通知

### Q: 可以猜测OTC密码吗？
A: ⚠️ 不建议！多次错误尝试可能被系统标记

### Q: 为什么Bristol版本不需要密码？
A: 不同学校的配置不同，Sheffield强制要求OTC

---

**更新时间**: 2025-10-03  
**版本**: v2.1  
**状态**: ✅ OTC支持已添加

